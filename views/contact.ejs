<!DOCTYPE html>
<html lang="en">
<%- include('partials/head', { title: title }) %>
<body>
  <%- include('partials/header') %>
  <main>
    <div class="contact-container">
      <h1>Contact Us</h1>
      <% if (success) { %><p class="success">Message sent successfully!</p><% } %>
      <% if (error) { %><p class="error"><%= error %></p><% } %>
      <form action="/contact" method="POST" class="contact-form">
        <label>Name:</label>
        <input type="text" name="name" placeholder="Your name" required><br>
        <label>Email:</label>
        <input type="email" name="email" placeholder="Your email" required><br>
        <label>Phone (Optional):</label>
        <input type="tel" name="phone" placeholder="Your phone number"><br>
        <label>Message:</label>
        <textarea name="message" placeholder="Your message" rows="5" required></textarea><br>
        <button type="submit">Send Message</button>
      </form>
    </div>
    <% if (user?.role === 'admin') { %>
      <hr>
      <h2>All Registered Users</h2>

      <% if (users && users.length > 0) { %>
        <table border="1" cellpadding="10" cellspacing="0" style="width:100%; border-collapse:collapse; margin-top:1rem; font-size:0.95rem;">
          <thead style="background:#e3f2fd;">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Joined</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach((u, i) => { %>
              <tr>
                <td><%= i + 1 %></td>
                <td><%= u.name || '—' %></td>
                <td><%= u.email %></td>
                <td>
                  <span style="padding:2px 8px; border-radius:4px; font-weight:bold; color:white; background:<%= u.role === 'admin' ? '#d32f2f' : '#1976d2' %>">
                    <%= (u.role || 'user').toUpperCase() %>
                  </span>
                </td>
                <td><%= u.createdAt ? new Date(u.createdAt).toLocaleString() : '—' %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p><em>No users found.</em></p>
      <% } %>
    <% } %>

    <hr>
      <h2>All Contact Form Submissions</h2>

      <% if (contacts && contacts.length > 0) { %>
        <table border="1" cellpadding="10" cellspacing="0" style="width:100%; border-collapse:collapse; margin:1.5rem 0; font-size:0.95rem;">
          <thead style="background:#fff3e0;">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Message</th>
              <th>Submitted</th>
            </tr>
          </thead>
          <tbody>
            <% contacts.forEach((c, i) => { %>
              <tr>
                <td><%= i + 1 %></td>
                <td><%= c.name %></td>
                <td><%= c.email %></td>
                <td><%= c.phone || '—' %></td>
                <td style="max-width:400px; word-wrap:break-word;"><%= c.message %></td>
                <td><%= new Date(c.date).toLocaleString() %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p><em>No contact messages yet.</em></p>
      <% } %>
    <% } %>
  </main>
  <%- include('partials/footer') %>
</body>
</html>
